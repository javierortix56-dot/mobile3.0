<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>GastroFit Finance</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAMAAAAKE/YAAAAAbFBMVEUAABAAAAAAVZ4AWp8AXaAAXJ8AXZ8AXJ8AXJ8AXJ8AXZ8AWp8AXJ8AXJ8AXJ8AXZ8AXJ8AXJ8AXZ8AXJ8AXJ8AXJ8AXJ8AXJ8AXJ8AXJ8AXZ8AXJ8AXZ8AXJ8AXZ8AXJ8AXJ8AXJ8AXJ8AXJ8AAABr1yUDAAAAJHRSTlMAVt//H/Df7///2f////////8Q////////////////////8A/w8N1AAAAD5UlEQVR4nO3c63KjMBCG4RkHMwlXCQlXgO//mk3C2SwlsbWSbZqZvmj+cTT2x0YjoS4XAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8p6vLq+ub2/uH+8fn17f3T9eXq+k41159Wq+m4+uH+8+fP3/+8+vnj/uH62k9116dpuv16eP958//6Z9/f3xcr+faK9N0fXn/y7/86/3lWntlmq7v/8l/vL5ce2Warj/+/a/X12uvTNOP/9d/vL5ee2Warj//X//x+nrtrT/VdC29M03X0jvT9P/SO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb2z/9F0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb0zTdfSO9N0Lb3zX03X9eX9L//yr/eXa+2Vabr+/Pn/T//8++Pjej3XXpmma+nV9eX9w/3jz//pn3//+vnj/uF6Wtfz3Hulq8ur65vb+4f7x+fXt/dP15er6TjXXgEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPgX/wFgK2h2n2RMPAAAAABJRU5ErkJggg==">

    <style>
        :root {
            --primary-color: #10b981;
            --danger-color: #ef4444;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-color: #1f2937;
            --safe-top: env(safe-area-inset-top); /* Variable clave para el Notch */
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            padding-bottom: 80px; /* Espacio para el FAB */
        }

        /* --- HEADER FIXED --- */
        .app-header {
            background-color: var(--card-bg);
            /* Padding top toma en cuenta el Notch o un mínimo de 15px */
            padding: calc(15px + var(--safe-top)) 20px 15px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .month-selector {
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            background: transparent;
            color: var(--text-color);
            cursor: pointer;
        }

        .header-actions button {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--text-color);
            margin-left: 15px;
            cursor: pointer;
        }

        /* --- DASHBOARD --- */
        .dashboard { padding: 20px; }

        .summary-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            text-align: center;
        }

        .card.full-width { grid-column: span 2; }

        .amount { font-size: 1.2rem; font-weight: bold; margin-top: 5px; }
        .income-text { color: var(--primary-color); }
        .expense-text { color: var(--danger-color); }

        /* --- CHARTS --- */
        .chart-container {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            position: relative;
            height: 250px;
        }
        
        .chart-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        .btn-reset-chart {
            background: #eee;
            border: none;
            padding: 2px 8px;
            border-radius: 5px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        /* --- LISTAS --- */
        .section-title { font-size: 1.1rem; margin-bottom: 10px; font-weight: 600; }

        .transaction-list { list-style: none; }

        .transaction-item {
            background: var(--card-bg);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .t-info { display: flex; flex-direction: column; }
        .t-cat { font-weight: 500; font-size: 1rem; }
        .t-concept { font-size: 0.85rem; color: #888; }
        
        .t-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .t-amount { font-weight: bold; margin-right: 5px; }
        
        .btn-icon {
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 1rem;
            padding: 5px;
            cursor: pointer;
        }
        .btn-icon.clone { color: #3b82f6; } /* Azul para clonar */

        /* --- RECURRENTES (MEJORA HIT AREA) --- */
        .recurring-item {
            background: var(--card-bg);
            padding: 18px; /* Aumentado padding interno */
            margin-bottom: 10px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer; /* Cursor de mano */
            min-height: 60px; /* Altura mínima para dedos */
            border-left: 4px solid #ccc;
        }
        .recurring-item.paid { border-left-color: var(--primary-color); opacity: 0.6; }

        /* --- FAB (BOTON FLOTANTE) --- */
        .fab {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background-color: var(--text-color);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: none;
            cursor: pointer;
            z-index: 900;
        }

        /* --- MODALS --- */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: flex-end; /* Mobile style bottom sheet */
        }
        .modal.active { display: flex; }

        .modal-content {
            background: white;
            width: 100%;
            border-radius: 20px 20px 0 0;
            padding: 25px;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            background: #f9fafb;
        }
        .btn-block {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            margin-top: 10px;
            cursor: pointer;
        }
        .btn-primary { background: var(--text-color); color: white; }
        .btn-secondary { background: #e5e7eb; color: var(--text-color); margin-top: 10px;}

    </style>
</head>
<body>

    <header class="app-header">
        <input type="month" id="monthPicker" class="month-selector">
        <div class="header-actions">
            <button onclick="abrirModalClonarMes()"><i class="fas fa-copy"></i></button> <button onclick="alert('Settings')"><i class="fas fa-cog"></i></button>
        </div>
    </header>

    <div class="dashboard">
        
        <div class="summary-cards">
            <div class="card">
                <div>Ingresos</div>
                <div class="amount income-text" id="totalIncome">$0</div>
            </div>
            <div class="card">
                <div>Gastos</div>
                <div class="amount expense-text" id="totalExpense">$0</div>
            </div>
            <div class="card full-width">
                <div>Balance</div>
                <div class="amount" id="totalBalance">$0</div>
            </div>
        </div>

        <div class="section-title">Análisis de Ingresos</div>
        <div class="chart-container">
            <div class="chart-nav">
                <span id="incomeChartTitle">Por Categoría</span>
                <button id="btnResetIncome" class="btn-reset-chart" style="display:none;" onclick="resetIncomeChart()">Volver</button>
            </div>
            <canvas id="incomeChart"></canvas>
        </div>

        <div class="section-title">Análisis de Gastos</div>
        <div class="chart-container">
            <div class="chart-nav">
                <span id="expenseChartTitle">Por Categoría</span>
                <button id="btnResetExpense" class="btn-reset-chart" style="display:none;" onclick="resetExpenseChart()">Volver</button>
            </div>
            <canvas id="expenseChart"></canvas>
        </div>

        <div class="section-title">Gastos Recurrentes</div>
        <div id="recurringList">
            </div>

        <div class="section-title">Movimientos</div>
        <ul class="transaction-list" id="transactionList">
            </ul>

    </div>

    <button class="fab" onclick="abrirModalAgregar()">
        <i class="fas fa-plus"></i>
    </button>

    <div class="modal" id="modalTransaction">
        <div class="modal-content">
            <h2 style="margin-bottom:20px;">Nuevo Movimiento</h2>
            <div class="form-group">
                <label>Tipo</label>
                <select id="tipo" class="form-control">
                    <option value="gasto">Gasto</option>
                    <option value="ingreso">Ingreso</option>
                </select>
            </div>
            <div class="form-group">
                <label>Monto</label>
                <input type="number" id="monto" class="form-control" placeholder="0.00">
            </div>
            <div class="form-group">
                <label>Categoría</label>
                <input type="text" id="categoria" class="form-control" placeholder="Ej. Comida, Sueldo">
            </div>
            <div class="form-group">
                <label>Concepto (Opcional)</label>
                <input type="text" id="concepto" class="form-control" placeholder="Ej. Pizza, Bono">
            </div>
            
            <input type="hidden" id="editId">

            <button class="btn-block btn-primary" onclick="guardarTransaccion()">Guardar</button>
            <button class="btn-block btn-secondary" onclick="cerrarModal()">Cancelar</button>
        </div>
    </div>

    <div class="modal" id="modalCloneMonth">
        <div class="modal-content">
            <h2 style="margin-bottom:10px;">Clonar Mes</h2>
            <p style="margin-bottom:20px; color:#666;">Elige de qué mes quieres copiar los movimientos:</p>
            
            <div class="form-group">
                <label>Mes Origen:</label>
                <select id="selectMesOrigen" class="form-control">
                    </select>
            </div>

            <button class="btn-block btn-primary" onclick="ejecutarClonacionMes()">Clonar Movimientos</button>
            <button class="btn-block btn-secondary" onclick="cerrarModalClonar()">Cancelar</button>
        </div>
    </div>

    <script>
        // --- ESTADO & DATOS ---
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        // Datos de ejemplo si está vacío
        if(transactions.length === 0) {
            transactions = [
                { id: '1', fecha: '2026-01-05', tipo: 'ingreso', categoria: 'Sueldo', concepto: 'Nomina', monto: 2000 },
                { id: '2', fecha: '2026-01-10', tipo: 'gasto', categoria: 'Comida', concepto: 'Supermercado', monto: 150 },
                { id: '3', fecha: '2026-01-12', tipo: 'gasto', categoria: 'Transporte', concepto: 'Gasolina', monto: 50 },
                { id: '4', fecha: '2025-12-01', tipo: 'ingreso', categoria: 'Sueldo', concepto: 'Nomina', monto: 2000 }
            ];
            localStorage.setItem('transactions', JSON.stringify(transactions));
        }

        let currentMonth = new Date().toISOString().slice(0, 7); // YYYY-MM
        const monthPicker = document.getElementById('monthPicker');
        monthPicker.value = currentMonth;

        // Variables Gráficos
        let incomeChartInstance = null;
        let expenseChartInstance = null;
        let incomeChartLevel = 'categoria'; // categoria | concepto
        let expenseChartLevel = 'categoria';
        let selectedIncomeCategory = null;
        let selectedExpenseCategory = null;

        // --- INICIALIZACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            renderAll();
        });

        monthPicker.addEventListener('change', (e) => {
            currentMonth = e.target.value;
            renderAll();
        });

        function renderAll() {
            const filtered = getMonthData();
            updateSummary(filtered);
            renderList(filtered);
            renderRecurring(filtered); // En una app real esto tendría lógica distinta
            
            // Render Gráficos
            renderIncomeChart(filtered);
            renderExpenseChart(filtered);
        }

        function getMonthData() {
            return transactions.filter(t => t.fecha.startsWith(currentMonth));
        }

        // --- LÓGICA DE GRÁFICOS (DRILL DOWN) ---

        // 1. GASTOS
        function renderExpenseChart(data) {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            const gastos = data.filter(t => t.tipo === 'gasto');
            let groupedData, labels, values;

            if (expenseChartLevel === 'categoria') {
                document.getElementById('expenseChartTitle').innerText = 'Por Categoría';
                document.getElementById('btnResetExpense').style.display = 'none';
                groupedData = agruparPor(gastos, 'categoria');
            } else {
                document.getElementById('expenseChartTitle').innerText = selectedExpenseCategory;
                document.getElementById('btnResetExpense').style.display = 'block';
                const filtrados = gastos.filter(t => t.categoria === selectedExpenseCategory);
                groupedData = agruparPor(filtrados, 'concepto');
            }

            labels = Object.keys(groupedData);
            values = Object.values(groupedData);

            if (expenseChartInstance) expenseChartInstance.destroy();

            expenseChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: ['#ef4444', '#f87171', '#fca5a5', '#b91c1c', '#991b1b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: (evt, activeElements) => {
                        if (activeElements.length > 0 && expenseChartLevel === 'categoria') {
                            const index = activeElements[0].index;
                            selectedExpenseCategory = labels[index];
                            expenseChartLevel = 'concepto';
                            renderExpenseChart(data);
                        }
                    }
                }
            });
        }

        function resetExpenseChart() {
            expenseChartLevel = 'categoria';
            selectedExpenseCategory = null;
            renderExpenseChart(getMonthData());
        }

        // 2. INGRESOS (Nueva Funcionalidad Solicitada)
        function renderIncomeChart(data) {
            const ctx = document.getElementById('incomeChart').getContext('2d');
            const ingresos = data.filter(t => t.tipo === 'ingreso');
            let groupedData, labels, values;

            if (incomeChartLevel === 'categoria') {
                document.getElementById('incomeChartTitle').innerText = 'Por Categoría';
                document.getElementById('btnResetIncome').style.display = 'none';
                groupedData = agruparPor(ingresos, 'categoria');
            } else {
                document.getElementById('incomeChartTitle').innerText = selectedIncomeCategory;
                document.getElementById('btnResetIncome').style.display = 'block';
                const filtrados = ingresos.filter(t => t.categoria === selectedIncomeCategory);
                groupedData = agruparPor(filtrados, 'concepto');
            }

            labels = Object.keys(groupedData);
            values = Object.values(groupedData);

            if (incomeChartInstance) incomeChartInstance.destroy();

            incomeChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: ['#10b981', '#34d399', '#6ee7b7', '#047857', '#065f46']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: (evt, activeElements) => {
                        if (activeElements.length > 0 && incomeChartLevel === 'categoria') {
                            const index = activeElements[0].index;
                            selectedIncomeCategory = labels[index];
                            incomeChartLevel = 'concepto';
                            renderIncomeChart(data);
                        }
                    }
                }
            });
        }

        function resetIncomeChart() {
            incomeChartLevel = 'categoria';
            selectedIncomeCategory = null;
            renderIncomeChart(getMonthData());
        }

        function agruparPor(lista, clave) {
            return lista.reduce((acc, curr) => {
                acc[curr[clave]] = (acc[curr[clave]] || 0) + parseFloat(curr.monto);
                return acc;
            }, {});
        }

        // --- UI UPDATES ---
        function updateSummary(data) {
            const income = data.filter(t => t.tipo === 'ingreso').reduce((sum, t) => sum + parseFloat(t.monto), 0);
            const expense = data.filter(t => t.tipo === 'gasto').reduce((sum, t) => sum + parseFloat(t.monto), 0);
            
            document.getElementById('totalIncome').innerText = `$${income.toFixed(2)}`;
            document.getElementById('totalExpense').innerText = `$${expense.toFixed(2)}`;
            document.getElementById('totalBalance').innerText = `$${(income - expense).toFixed(2)}`;
        }

        function renderList(data) {
            const list = document.getElementById('transactionList');
            list.innerHTML = '';
            data.forEach(t => {
                const li = document.createElement('li');
                li.className = 'transaction-item';
                li.innerHTML = `
                    <div class="t-info">
                        <span class="t-cat">${t.categoria}</span>
                        <span class="t-concept">${t.concepto || ''}</span>
                    </div>
                    <div class="t-actions">
                        <span class="t-amount" style="color:${t.tipo==='ingreso'?'var(--primary-color)':'var(--danger-color)'}">
                            $${t.monto}
                        </span>
                        <button class="btn-icon clone" onclick="clonarTransaccionIndividual('${t.id}')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                `;
                list.appendChild(li);
            });
        }

        function renderRecurring(data) {
            // Simulamos gastos recurrentes detectando la palabra "Recurrente" en categoria o concepto para demo
            const list = document.getElementById('recurringList');
            list.innerHTML = '';
            
            // Para demo, creamos uno falso si no hay
            const mockRecurring = { id: 'rec1', categoria: 'Alquiler', monto: 500, pagado: false };
            
            const div = document.createElement('div');
            // Clase recurring-item tiene mas padding ahora
            div.className = `recurring-item ${mockRecurring.pagado ? 'paid' : ''}`;
            div.onclick = () => { alert('Abriendo edición de recurrente (Hit area mejorado)'); };
            div.innerHTML = `
                <div>
                    <strong>${mockRecurring.categoria}</strong>
                    <div style="font-size:0.8rem; color:#666">Vence el 05</div>
                </div>
                <strong>$${mockRecurring.monto}</strong>
            `;
            list.appendChild(div);
        }

        // --- OPERACIONES ---
        
        function abrirModalAgregar() {
            document.getElementById('editId').value = '';
            document.getElementById('monto').value = '';
            document.getElementById('categoria').value = '';
            document.getElementById('concepto').value = '';
            document.getElementById('modalTransaction').classList.add('active');
        }

        function cerrarModal() {
            document.getElementById('modalTransaction').classList.remove('active');
        }

        function guardarTransaccion() {
            const tipo = document.getElementById('tipo').value;
            const monto = document.getElementById('monto').value;
            const cat = document.getElementById('categoria').value;
            const con = document.getElementById('concepto').value;
            const id = document.getElementById('editId').value;

            if(!monto || !cat) return alert('Completa monto y categoría');

            const nueva = {
                id: id || Date.now().toString(),
                fecha: id ? transactions.find(t=>t.id===id).fecha : currentMonth + '-01', // Asigna al mes actual
                tipo,
                categoria: cat,
                concepto: con,
                monto: parseFloat(monto)
            };

            if(id) {
                const index = transactions.findIndex(t => t.id === id);
                transactions[index] = nueva;
            } else {
                transactions.push(nueva);
            }

            localStorage.setItem('transactions', JSON.stringify(transactions));
            cerrarModal();
            renderAll();
        }

        // --- CLONAR INDIVIDUAL ---
        function clonarTransaccionIndividual(id) {
            const original = transactions.find(t => t.id === id);
            if (!original) return;

            const confirmacion = confirm(`¿Clonar ${original.categoria} - ${original.concepto}?`);
            if(!confirmacion) return;

            const copia = {
                ...original,
                id: Date.now().toString(),
                fecha: currentMonth + '-' + new Date().getDate() // Clona con fecha de HOY en el mes seleccionado
            };

            transactions.push(copia);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            renderAll();
        }

        // --- CLONAR MES ---
        function abrirModalClonarMes() {
            // 1. Obtener meses únicos disponibles
            const mesesDisponibles = [...new Set(transactions.map(t => t.fecha.slice(0, 7)))];
            const select = document.getElementById('selectMesOrigen');
            select.innerHTML = '';

            // Filtrar para no clonar el mes actual sobre sí mismo (opcional)
            const opciones = mesesDisponibles.filter(m => m !== currentMonth).sort().reverse();

            if (opciones.length === 0) {
                alert("No hay meses anteriores para clonar.");
                return;
            }

            opciones.forEach(mes => {
                const opt = document.createElement('option');
                opt.value = mes;
                opt.innerText = mes;
                select.appendChild(opt);
            });

            document.getElementById('modalCloneMonth').classList.add('active');
        }

        function cerrarModalClonar() {
            document.getElementById('modalCloneMonth').classList.remove('active');
        }

        function ejecutarClonacionMes() {
            const mesOrigen = document.getElementById('selectMesOrigen').value;
            if(!mesOrigen) return;

            const txOrigen = transactions.filter(t => t.fecha.startsWith(mesOrigen));
            
            if(confirm(`¿Copiar ${txOrigen.length} movimientos de ${mesOrigen} a ${currentMonth}?`)) {
                txOrigen.forEach(t => {
                    transactions.push({
                        ...t,
                        id: Date.now().toString() + Math.random(),
                        fecha: currentMonth + '-01' // Pone todo al día 1 del mes actual
                    });
                });
                
                localStorage.setItem('transactions', JSON.stringify(transactions));
                cerrarModalClonar();
                renderAll();
            }
        }

    </script>
</body>
</html>
